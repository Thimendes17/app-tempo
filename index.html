<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C√©u ‚Äî Previs√£o do Tempo</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0f1e;
    --bg2: #0f172a;
    --card: rgba(255,255,255,0.04);
    --card-border: rgba(255,255,255,0.08);
    --text: #f0f4ff;
    --text2: #7c8db5;
    --accent: #4f8ef7;
    --accent2: #7eb8f7;
    --glow: rgba(79,142,247,0.15);
    --shadow: rgba(0,0,0,0.4);
    --chip: rgba(255,255,255,0.06);
    --chip-border: rgba(255,255,255,0.1);
  }
  [data-theme="light"] {
    --bg: #e8eef8;
    --bg2: #dde6f4;
    --card: rgba(255,255,255,0.7);
    --card-border: rgba(100,140,200,0.2);
    --text: #0f1b33;
    --text2: #556080;
    --accent: #2563eb;
    --accent2: #3b82f6;
    --glow: rgba(37,99,235,0.12);
    --shadow: rgba(30,60,130,0.12);
    --chip: rgba(37,99,235,0.08);
    --chip-border: rgba(37,99,235,0.18);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    transition: background 0.4s, color 0.4s;
    overflow-x: hidden;
  }

  /* Atmospheric background */
  body::before {
    content: '';
    position: fixed;
    top: -30%;
    left: -20%;
    width: 70%;
    height: 70%;
    background: radial-gradient(ellipse, var(--glow) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
    animation: drift 12s ease-in-out infinite alternate;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -20%;
    right: -10%;
    width: 50%;
    height: 60%;
    background: radial-gradient(ellipse, rgba(126,184,247,0.08) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
    animation: drift 16s ease-in-out infinite alternate-reverse;
  }

  @keyframes drift {
    from { transform: translate(0,0) scale(1); }
    to { transform: translate(3%,4%) scale(1.05); }
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
  }

  /* Header */
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2.5rem;
  }

  .logo {
    font-family: 'Syne', sans-serif;
    font-size: 1.4rem;
    font-weight: 800;
    letter-spacing: -0.04em;
    color: var(--text);
  }
  .logo span { color: var(--accent); }

  .theme-btn {
    background: var(--card);
    border: 1px solid var(--card-border);
    color: var(--text);
    cursor: pointer;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    transition: all 0.3s;
    backdrop-filter: blur(8px);
  }
  .theme-btn:hover {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
    transform: rotate(20deg) scale(1.1);
  }

  /* Search */
  .search-wrap {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 2rem;
  }

  .search-input {
    flex: 1;
    background: var(--card);
    border: 1px solid var(--card-border);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    padding: 0.9rem 1.3rem;
    border-radius: 14px;
    backdrop-filter: blur(12px);
    transition: all 0.3s;
    outline: none;
  }
  .search-input::placeholder { color: var(--text2); }
  .search-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--glow);
  }

  .search-btn {
    background: var(--accent);
    border: none;
    color: #fff;
    font-family: 'Syne', sans-serif;
    font-weight: 600;
    font-size: 0.9rem;
    padding: 0.9rem 1.5rem;
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
  }
  .search-btn:hover {
    background: var(--accent2);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px var(--glow);
  }
  .search-btn:active { transform: translateY(0); }

  /* Error/Loading */
  .message {
    text-align: center;
    padding: 2rem;
    color: var(--text2);
    font-size: 0.95rem;
  }
  .error { color: #f87171; }

  /* Main Weather Card */
  .weather-main {
    background: var(--card);
    border: 1px solid var(--card-border);
    border-radius: 24px;
    padding: 2rem 2.2rem;
    backdrop-filter: blur(20px);
    box-shadow: 0 20px 60px var(--shadow);
    margin-bottom: 1.2rem;
    display: none;
    animation: fadeUp 0.5s ease;
  }
  .weather-main.visible { display: block; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .city-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 1.5rem;
  }

  .city-name {
    font-family: 'Syne', sans-serif;
    font-size: 2rem;
    font-weight: 800;
    letter-spacing: -0.04em;
    line-height: 1.1;
  }
  .city-country {
    font-size: 0.85rem;
    color: var(--text2);
    margin-top: 0.2rem;
    font-weight: 300;
  }

  .datetime {
    text-align: right;
    font-size: 0.8rem;
    color: var(--text2);
    font-weight: 300;
    line-height: 1.6;
  }

  .temp-row {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 1.2rem;
  }

  .weather-icon {
    font-size: 5rem;
    line-height: 1;
    filter: drop-shadow(0 0 20px var(--glow));
    animation: floatIcon 4s ease-in-out infinite;
  }
  @keyframes floatIcon {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  .temp-info {}
  .temp-main {
    font-family: 'Syne', sans-serif;
    font-size: 5.5rem;
    font-weight: 800;
    letter-spacing: -0.06em;
    line-height: 1;
    color: var(--text);
  }
  .temp-main sup {
    font-size: 2rem;
    vertical-align: super;
    font-weight: 600;
  }
  .description {
    font-size: 1rem;
    color: var(--text2);
    text-transform: capitalize;
    margin-top: 0.2rem;
  }
  .feels-like {
    font-size: 0.82rem;
    color: var(--text2);
    margin-top: 0.1rem;
  }

  /* Stats row */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.8rem;
    margin-top: 1.5rem;
  }

  .stat-chip {
    background: var(--chip);
    border: 1px solid var(--chip-border);
    border-radius: 14px;
    padding: 0.9rem 0.7rem;
    text-align: center;
    transition: transform 0.2s;
  }
  .stat-chip:hover { transform: translateY(-3px); }
  .stat-icon { font-size: 1.3rem; margin-bottom: 0.3rem; }
  .stat-value {
    font-family: 'Syne', sans-serif;
    font-size: 1.1rem;
    font-weight: 700;
    letter-spacing: -0.02em;
  }
  .stat-label {
    font-size: 0.72rem;
    color: var(--text2);
    margin-top: 0.1rem;
    font-weight: 300;
  }

  /* Forecast */
  .forecast-section {
    display: none;
    animation: fadeUp 0.5s ease 0.1s both;
  }
  .forecast-section.visible { display: block; }

  .section-title {
    font-family: 'Syne', sans-serif;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text2);
    margin-bottom: 0.9rem;
  }

  .forecast-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.8rem;
  }

  .forecast-card {
    background: var(--card);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    padding: 1rem 0.6rem;
    text-align: center;
    backdrop-filter: blur(12px);
    transition: all 0.3s;
    cursor: default;
  }
  .forecast-card:hover {
    transform: translateY(-4px);
    border-color: var(--accent);
    box-shadow: 0 8px 24px var(--glow);
  }
  .fc-day {
    font-family: 'Syne', sans-serif;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text2);
    margin-bottom: 0.5rem;
  }
  .fc-icon { font-size: 2rem; margin-bottom: 0.5rem; }
  .fc-temps {
    display: flex;
    justify-content: center;
    gap: 0.4rem;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
  }
  .fc-max { color: var(--text); }
  .fc-min { color: var(--text2); font-weight: 400; }

  .loader {
    display: none;
    text-align: center;
    padding: 3rem;
  }
  .loader.visible { display: block; }
  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--card-border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 1rem;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Responsive */
  @media (max-width: 600px) {
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .forecast-grid { grid-template-columns: repeat(3, 1fr); }
    .forecast-grid .forecast-card:nth-child(n+4):nth-last-child(-n+2) { display: none; }
    .temp-main { font-size: 4rem; }
    .city-name { font-size: 1.5rem; }
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <div class="logo">c√©<span>u</span></div>
    <button class="theme-btn" id="themeBtn" title="Alternar tema" aria-label="Alternar tema claro/escuro">üåô</button>
  </header>

  <div class="search-wrap">
    <input class="search-input" id="cityInput" type="text" placeholder="Digite uma cidade... ex: S√£o Paulo, BR" />
    <button class="search-btn" id="searchBtn">Buscar</button>
  </div>

  <div class="loader" id="loader">
    <div class="spinner"></div>
    <p style="color:var(--text2);font-size:0.9rem">Consultando dados meteorol√≥gicos‚Ä¶</p>
  </div>

  <div id="errorMsg" class="message error" style="display:none"></div>
  <div id="emptyMsg" class="message">üå§ Digite uma cidade para ver a previs√£o do tempo</div>

  <div class="weather-main" id="weatherMain">
    <div class="city-row">
      <div>
        <div class="city-name" id="cityName">‚Äî</div>
        <div class="city-country" id="cityCountry">‚Äî</div>
      </div>
      <div class="datetime" id="datetime">‚Äî</div>
    </div>
    <div class="temp-row">
      <div class="weather-icon" id="weatherIcon">‚Äî</div>
      <div class="temp-info">
        <div class="temp-main" id="tempMain">‚Äî<sup>¬∞C</sup></div>
        <div class="description" id="description">‚Äî</div>
        <div class="feels-like" id="feelsLike">‚Äî</div>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-chip">
        <div class="stat-icon">üíß</div>
        <div class="stat-value" id="humidity">‚Äî</div>
        <div class="stat-label">Umidade</div>
      </div>
      <div class="stat-chip">
        <div class="stat-icon">üí®</div>
        <div class="stat-value" id="wind">‚Äî</div>
        <div class="stat-label">Vento</div>
      </div>
      <div class="stat-chip">
        <div class="stat-icon">üå°Ô∏è</div>
        <div class="stat-value" id="pressure">‚Äî</div>
        <div class="stat-label">Press√£o</div>
      </div>
      <div class="stat-chip">
        <div class="stat-icon">üëÅÔ∏è</div>
        <div class="stat-value" id="visibility">‚Äî</div>
        <div class="stat-label">Visibilidade</div>
      </div>
    </div>
  </div>

  <div class="forecast-section" id="forecastSection">
    <p class="section-title">Pr√≥ximos 5 dias</p>
    <div class="forecast-grid" id="forecastGrid"></div>
  </div>
</div>

<script>
  // ===================== CONFIG =====================
  const API_KEY = '4c24ae850e33c680fc7fab2efc024081'; // OpenWeatherMap API key
  const BASE = 'https://api.openweathermap.org/data/2.5';

  // ===================== THEME =====================
  const html = document.documentElement;
  const themeBtn = document.getElementById('themeBtn');
  let isDark = true;

  themeBtn.addEventListener('click', () => {
    isDark = !isDark;
    html.setAttribute('data-theme', isDark ? 'dark' : 'light');
    themeBtn.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
  });

  // ===================== WEATHER ICONS =====================
  function getIcon(id, isDay = true) {
    if (id >= 200 && id < 300) return '‚õàÔ∏è';
    if (id >= 300 && id < 400) return 'üå¶Ô∏è';
    if (id >= 500 && id < 510) return id < 502 ? 'üåßÔ∏è' : '‚õàÔ∏è';
    if (id === 511) return 'üå®Ô∏è';
    if (id >= 520 && id < 532) return 'üå¶Ô∏è';
    if (id >= 600 && id < 700) return '‚ùÑÔ∏è';
    if (id >= 700 && id < 800) return 'üå´Ô∏è';
    if (id === 800) return isDay ? '‚òÄÔ∏è' : 'üåô';
    if (id === 801) return isDay ? 'üå§Ô∏è' : 'üåô';
    if (id === 802) return '‚õÖ';
    if (id >= 803) return '‚òÅÔ∏è';
    return 'üå°Ô∏è';
  }

  // ===================== FORMAT DATE =====================
  function formatDate(ts, tz) {
    const d = new Date((ts + tz) * 1000);
    return d.toUTCString().replace('GMT', '').trim().split(':').slice(0,2).join(':');
  }

  function getDayName(ts) {
    const days = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
    const d = new Date(ts * 1000);
    return days[d.getDay()];
  }

  // ===================== UI HELPERS =====================
  const $ = id => document.getElementById(id);

  function showLoader(v) { $('loader').classList.toggle('visible', v); }
  function showMain(v) { $('weatherMain').classList.toggle('visible', v); }
  function showForecast(v) { $('forecastSection').classList.toggle('visible', v); }
  function showEmpty(v) { $('emptyMsg').style.display = v ? 'block' : 'none'; }
  function showError(msg) {
    const el = $('errorMsg');
    el.textContent = msg;
    el.style.display = msg ? 'block' : 'none';
  }

  // ===================== FETCH WEATHER =====================
  async function fetchWeather(city) {
    showLoader(true);
    showMain(false);
    showForecast(false);
    showEmpty(false);
    showError('');

    try {
      const [cur, fore] = await Promise.all([
        fetch(`${BASE}/weather?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric&lang=pt_br`).then(r => r.json()),
        fetch(`${BASE}/forecast?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric&lang=pt_br`).then(r => r.json())
      ]);

      if (cur.cod !== 200) throw new Error(cur.message || 'Cidade n√£o encontrada');
      if (fore.cod !== '200') throw new Error('Erro ao buscar previs√£o');

      renderCurrent(cur);
      renderForecast(fore);

      showMain(true);
      showForecast(true);

    } catch(e) {
      showError('‚ùå ' + (e.message === 'city not found' ? 'Cidade n√£o encontrada. Verifique o nome e tente novamente.' : e.message));
      showEmpty(true);
    } finally {
      showLoader(false);
    }
  }

  // ===================== RENDER CURRENT =====================
  function renderCurrent(d) {
    const isDay = d.dt > d.sys.sunrise && d.dt < d.sys.sunset;
    $('cityName').textContent = d.name;
    $('cityCountry').textContent = `${d.sys.country} ¬∑ ${d.coord.lat.toFixed(2)}¬∞, ${d.coord.lon.toFixed(2)}¬∞`;
    $('datetime').innerHTML = `${new Date().toLocaleDateString('pt-BR',{weekday:'long'})}<br>${new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}`;
    $('weatherIcon').textContent = getIcon(d.weather[0].id, isDay);
    $('tempMain').innerHTML = `${Math.round(d.main.temp)}<sup>¬∞C</sup>`;
    $('description').textContent = d.weather[0].description;
    $('feelsLike').textContent = `Sensa√ß√£o t√©rmica ${Math.round(d.main.feels_like)}¬∞C`;
    $('humidity').textContent = d.main.humidity + '%';
    $('wind').textContent = (d.wind.speed * 3.6).toFixed(0) + ' km/h';
    $('pressure').textContent = d.main.pressure + ' hPa';
    $('visibility').textContent = (d.visibility / 1000).toFixed(1) + ' km';
  }

  // ===================== RENDER FORECAST =====================
  function renderForecast(data) {
    // One entry per day (noon)
    const daily = {};
    data.list.forEach(item => {
      const date = item.dt_txt.split(' ')[0];
      const hour = item.dt_txt.split(' ')[1];
      if (!daily[date]) daily[date] = [];
      daily[date].push(item);
    });

    const days = Object.keys(daily).slice(0, 5);
    const grid = $('forecastGrid');
    grid.innerHTML = '';

    days.forEach(date => {
      const items = daily[date];
      const temps = items.map(i => i.main.temp);
      const max = Math.round(Math.max(...temps));
      const min = Math.round(Math.min(...temps));
      const noon = items.find(i => i.dt_txt.includes('12:00:00')) || items[Math.floor(items.length/2)];
      const icon = getIcon(noon.weather[0].id, true);
      const day = getDayName(items[0].dt);

      const card = document.createElement('div');
      card.className = 'forecast-card';
      card.innerHTML = `
        <div class="fc-day">${day}</div>
        <div class="fc-icon">${icon}</div>
        <div class="fc-temps">
          <span class="fc-max">${max}¬∞</span>
          <span class="fc-min">${min}¬∞</span>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  // ===================== EVENTS =====================
  $('searchBtn').addEventListener('click', () => {
    const city = $('cityInput').value.trim();
    if (city) fetchWeather(city);
  });

  $('cityInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const city = e.target.value.trim();
      if (city) fetchWeather(city);
    }
  });

  // Auto-load user location on start
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(async pos => {
      const { latitude: lat, longitude: lon } = pos.coords;
      showLoader(true);
      showEmpty(false);
      try {
        const [cur, fore] = await Promise.all([
          fetch(`${BASE}/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=pt_br`).then(r=>r.json()),
          fetch(`${BASE}/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=pt_br`).then(r=>r.json())
        ]);
        if (cur.cod === 200) {
          $('cityInput').value = cur.name;
          renderCurrent(cur);
          renderForecast(fore);
          showMain(true);
          showForecast(true);
        }
      } catch(e) {}
      finally { showLoader(false); }
    }, () => {});
  }
</script>
</body>
</html>